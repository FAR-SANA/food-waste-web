<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Posts</title>

<style>

/* ===== GLOBAL ===== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4fdf6;
}

/* ===== NAVBAR ===== */
.navbar {
  background: #2e7d32;
  padding: 15px 30px;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 20px;
  font-weight: bold;
}

.nav-links {
  display: flex;
  gap: 20px;
  align-items: center;
}

.nav-links a {
  color: white;
  text-decoration: none;
  font-weight: 600;
  padding-bottom: 3px;
}

.nav-links a:hover,
.nav-links a.active {
  border-bottom: 2px solid white;
}

.logout-btn {
  background: #c62828;
  border: none;
  padding: 8px 15px;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== CONTAINER ===== */
.dashboard-container {
  max-width: 1200px;
  margin: auto;
  padding: 30px 20px;
}

/* ===== HEADER ===== */
.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
}

.dashboard-header h2 {
  color: #2e7d32;
}

.search-box {
  display: flex;
  gap: 10px;
}

.search-box input {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

.search-box button {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  background: #43a047;
  color: white;
  cursor: pointer;
}

/* ===== POSTS GRID ===== */
.posts-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

/* ===== POST CARD ===== */
.post-card {
  background: white;
  border-left: 5px solid #43a047;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
}

.post-card h3 {
  margin: 0 0 10px;
  color: #2e7d32;
}

.post-card p {
  margin: 5px 0;
  font-size: 14px;
}

.status {
  display: inline-block;
  margin-top: 10px;
  font-size: 12px;
  font-weight: bold;
  padding: 5px 10px;
  border-radius: 20px;
}

.available {
  background: #c8e6c9;
  color: #2e7d32;
}

.claimed {
  background: #ffe0b2;
  color: #ff6f00;
}

/* ===== ACTION BUTTONS ===== */
.post-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.post-actions button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 13px;
}

.edit-btn {
  background: #1976d2;
  color: white;
}

.delete-btn {
  background: #d32f2f;
  color: white;
}

.claim-btn {
  background: #43a047;
  color: white;
}

/* ===== EMPTY MESSAGE ===== */
.empty-message {
  text-align: center;
  margin-top: 40px;
  color: #777;
}

@media(max-width: 768px){
  .dashboard-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }
}

</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="logo">ðŸ¥— Donor Dashboard</div>
  <div class="nav-links">
    <a href="donor.html">Home</a>
    <a href="managepost.html" class="active">Manage Posts</a>
    <a href="profiledonor.html">Profile</a>
  </div>
  <button class="logout-btn">Logout</button>
</nav>

<!-- DASHBOARD -->
<div class="dashboard-container">

  <div class="dashboard-header">
    <h2>Manage Posts</h2>
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Search posts...">
      <button onclick="loadPosts()">Search</button>
    </div>
  </div>

  <div class="posts-container" id="postsContainer"></div>
  <div class="empty-message" id="emptyMessage">Loading posts...</div>

</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

/* ===== REPLACE WITH YOUR REAL SUPABASE KEYS ===== */
const supabaseUrl = "YOUR_SUPABASE_URL";
const supabaseKey = "YOUR_SUPABASE_ANON_KEY";

let supabaseClient = null;
let isDemoMode = false;

/* ===== DEMO DATA ===== */
let demoPosts = [
  { id: "1", title: "Rice & Curry", quantity: "10 Packets", location: "City Center", status: "available" },
  { id: "2", title: "Bread Loaves", quantity: "15 Pieces", location: "Main Street", status: "claimed" },
  { id: "3", title: "Vegetable Biryani", quantity: "8 Boxes", location: "North Street", status: "available" }
];

/* ===== INIT MODE ===== */
if (supabaseUrl !== "YOUR_SUPABASE_URL" && supabaseKey !== "YOUR_SUPABASE_ANON_KEY") {
  supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
} else {
  isDemoMode = true;
}

/* ===== LOAD POSTS ===== */
async function loadPosts() {

  const searchText = document.getElementById('search-input').value.trim().toLowerCase();
  const container = document.getElementById('postsContainer');
  const emptyMessage = document.getElementById('emptyMessage');

  container.innerHTML = '';

  let data = [];

  if (isDemoMode) {

    data = demoPosts.filter(post =>
      post.title.toLowerCase().includes(searchText)
    );

  } else {

    let query = supabaseClient
      .from('posts')
      .select('*')
      .order('created_at', { ascending: false });

    if (searchText) {
      query = query.ilike('title', `%${searchText}%`);
    }

    const { data: dbData, error } = await query;

    if (error) {
      emptyMessage.innerText = "Error loading posts.";
      return;
    }

    data = dbData;
  }

  if (!data || data.length === 0) {
    emptyMessage.innerText = "No posts available.";
    return;
  }

  emptyMessage.innerText = "";

  data.forEach(post => {

    const card = document.createElement('div');
    card.className = "post-card";

    card.innerHTML = `
      <h3>${post.title}</h3>
      <p><strong>Quantity:</strong> ${post.quantity}</p>
      <p><strong>Location:</strong> ${post.location}</p>
      <span class="status ${post.status === 'claimed' ? 'claimed' : 'available'}">
        ${post.status}
      </span>
      <div class="post-actions">
        <button class="edit-btn" onclick="editPost('${post.id}')">Edit</button>
        <button class="delete-btn" onclick="deletePost('${post.id}')">Delete</button>
        <button class="claim-btn" onclick="claimPost('${post.id}')">Claim</button>
      </div>
    `;

    container.appendChild(card);

  });

}

/* ===== ACTIONS ===== */

function editPost(id){
  alert("Edit functionality coming soon. Post ID: " + id);
}

async function deletePost(id){

  if(!confirm("Delete this post?")) return;

  if (isDemoMode) {
    demoPosts = demoPosts.filter(post => post.id !== id);
    loadPosts();
    return;
  }

  const { error } = await supabaseClient.from('posts').delete().eq('id', id);

  if(error) alert("Failed to delete.");
  else loadPosts();
}

async function claimPost(id){

  if (isDemoMode) {
    demoPosts = demoPosts.map(post =>
      post.id === id ? { ...post, status: 'claimed' } : post
    );
    loadPosts();
    return;
  }

  const { error } = await supabaseClient.from('posts')
    .update({ status: 'claimed' })
    .eq('id', id);

  if(error) alert("Failed to update.");
  else loadPosts();
}

/* LOAD ON PAGE OPEN */
loadPosts();

</script>

</body>
</html>